# Packaging Documentation

This document describes the packaging and distribution setup for polly.

## Files Overview

### AUR Packaging
- **PKGBUILD-polly**: Package build script for stable releases from git tags
- **PKGBUILD-polly-git**: Package build script for the development version
- **polly.install**: Post-install script that displays instructions to users
- **generate-srcinfo.sh**: Helper script to generate .SRCINFO files for AUR

### Release Automation
- **.github/workflows/release.yml**: Automated release workflow that builds binaries for multiple architectures
- **Cross.toml**: Configuration for cross-compilation with required system dependencies

### System Integration
- **polly.service**: systemd user service for auto-starting polly

### Documentation
- **AUR_INSTALL.md**: Comprehensive installation guide for AUR users
- **RELEASE.md**: Release process documentation for maintainers

## Binary Release Workflow

The release workflow (`.github/workflows/release.yml`) is triggered when:
- A git tag matching `v*` is pushed (e.g., `v0.1.0`)
- Manually via workflow dispatch

### Build Targets

The workflow builds binaries for the following targets:

1. **x86_64-unknown-linux-gnu**
   - Standard Linux x86_64 binary
   - Dynamically linked against glibc
   - Best for most Linux distributions

2. **x86_64-unknown-linux-musl**
   - Static Linux x86_64 binary
   - Statically linked against musl libc
   - More portable, works on any Linux distro

3. **aarch64-unknown-linux-gnu**
   - ARM64 Linux binary
   - For ARM-based systems (Raspberry Pi, etc.)

### Release Artifacts

Each release includes:
- Source code (auto-generated by GitHub)
- Binary tarballs for each target architecture
- Release notes (auto-generated from commits)

## AUR Package Structure

### polly (Stable)

The stable package tracks tagged releases:
- Downloads source from GitHub releases
- Builds from a specific version tag
- Updates require manual version bumps

### polly-git (Development)

The git package tracks the main branch:
- Clones the git repository
- Builds from the latest commit
- Version is auto-generated from git history

## Installation Methods

Users can install polly via:

1. **AUR (Arch Linux)**
   ```bash
   yay -S polly          # Stable
   yay -S polly-git      # Development
   ```

2. **Pre-built Binary**
   - Download from GitHub releases
   - Extract and copy to `/usr/local/bin/polly`

3. **From Source**
   ```bash
   cargo build --release
   ```

## Post-Installation

After installation, users can:

1. **Enable systemd service (recommended)**
   ```bash
   systemctl --user enable --now polly.service
   ```

2. **Manual startup**
   - Add `polly &` to compositor config
   - Run manually: `polly`

## Maintenance

### Creating a Release

1. Update version in `Cargo.toml` and `PKGBUILD-polly`
2. Commit changes
3. Create and push git tag: `git tag -a v0.1.0 -m "Release v0.1.0"`
4. Workflow automatically builds and creates GitHub release

### Updating AUR

After a new release:

1. Update `sha256sums` in `PKGBUILD-polly`
2. Generate .SRCINFO: `makepkg --printsrcinfo > .SRCINFO`
3. Commit and push to AUR repository

See [RELEASE.md](RELEASE.md) for detailed instructions.

## Dependencies

### Runtime
- glib2: GLib library
- polkit: PolicyKit framework

### Build
- rust: Rust compiler (1.70+)
- cargo: Rust package manager
- libglib2.0-dev: GLib development files
- libpolkit-gobject-1-dev: Polkit GObject development files
- libpolkit-agent-1-dev: Polkit agent development files

## Architecture Support

Officially supported architectures:
- x86_64 (Intel/AMD 64-bit)
- aarch64 (ARM 64-bit)

Other architectures may work but are not officially supported or tested.
